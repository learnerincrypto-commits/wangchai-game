<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>旺柴互动小游戏 Wangchai Interactive Game</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      background: #e0f7fa;
      font-family: Arial, sans-serif;
    }
    .avatar {
      position: relative;
      width: 300px;
    }
    .avatar img {
      width: 100%;
      display: block;
    }
    .hotspot {
      position: absolute;
      cursor: pointer;
      background: rgba(255, 0, 0, 0);
    }
    #score, #timer {
      font-size: 22px;
      font-weight: bold;
      margin: 5px;
      color: #00796b;
    }
    #reaction {
      margin-top: 10px;
      font-size: 18px;
      color: #333;
      text-align: center;
    }
    /* 视频菜单 */
    #videoMenu {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
      text-align: center;
      z-index: 1000;
    }
    #videoMenu h2 { margin-bottom: 15px; }
    #videoMenu button {
      display: block;
      margin: 8px auto;
      padding: 8px 15px;
      border: none;
      background: #00796b;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
    #videoMenu button:hover { background: #004d40; }
    #videoPlayer {
      margin-top: 10px;
      width: 300px;
      display: none;
    }
    /* 音乐按钮 */
    #musicControl {
      margin-top: 15px;
      padding: 8px 15px;
      background: #ff9800;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      color: white;
      font-size: 16px;
    }
    #musicControl:hover { background: #e68900; }
    /* 排行榜 */
    #leaderboard {
      margin-top: 20px;
      padding: 10px;
      background: #ffffffaa;
      border-radius: 10px;
      width: 300px;
    }
    #leaderboard h2 { margin: 0 0 10px; font-size: 20px; }
  </style>
</head>
<body>
  <h1>旺柴互动小游戏<br>Wangchai Interactive Game</h1>
  <div id="score">分数/Score：0</div>
  <div id="timer">剩余时间/Time Left：30 秒/sec</div>

  <div class="avatar">
    <img id="dog" src="wangchai 1.png" alt="狗头 Dog Head">
    <!-- 点击区域 -->
    <div class="hotspot" id="hs1" style="left:80px; top:100px; width:60px; height:60px;" onclick="react(true, '眼睛/Eyes', 10)"></div>
    <div class="hotspot" id="hs2" style="left:120px; top:170px; width:60px; height:60px;" onclick="react(true, '嘴巴/Mouth', 20)"></div>
    <div class="hotspot" id="hs3" style="left:200px; top:50px; width:60px; height:60px;" onclick="react(false, '耳朵/Ears', -20)"></div>
  </div>

  <div id="reaction">👆 点击旺柴看看反应！<br>👆 Tap Wangchai to see reaction!</div>
  <button id="musicControl" onclick="toggleMusic()">暂停音乐 / Pause Music</button>

  <!-- 背景音乐 -->
  <audio id="bgm" src="bgm.mp3" autoplay loop></audio>

  <!-- 视频菜单 -->
  <div id="videoMenu">
    <h2>🎬 菜单 / Video Menu</h2>
    <div id="videoOptions"></div>
    <video id="videoPlayer" controls></video>
  </div>

  <!-- 排行榜 -->
  <div id="leaderboard">
    <h2>🏆 排行榜 / Leaderboard</h2>
    <ol id="leaderboardList"></ol>
  </div>

  <script>
    let score = 0;
    let timeLeft = 30;
    let countdown;
    let hotspotMove;
    let phase = 1; // 当前阶段 / Current phase
    let hotspotSize = 60;

    const faces = [
      "wangchai 1.png","wangchai 2.png","wangchai 3.png",
      "wangchai 4.png","wangchai 5.png","wangchai 6.png",
      "wangchai 7.png","wangchai 8.png","wangchai 9.png","wangchai 10.png"
    ];

    const bgm = document.getElementById("bgm");
    const musicBtn = document.getElementById("musicControl");

    function startTimer() {
      clearInterval(countdown);
      countdown = setInterval(() => {
        timeLeft--;
        document.getElementById("timer").innerText = "剩余时间/Time Left：" + timeLeft + " 秒/sec";
        if (timeLeft <= 0) {
          gameOver();
        }
      }, 1000);
    }

    function setPhase(newPhase) {
      phase = newPhase;
      clearInterval(hotspotMove);
      if (phase === 1) {
        timeLeft = Math.max(timeLeft, 25);
        hotspotSize = 60;
      } else if (phase === 2) {
        timeLeft = Math.max(timeLeft, 20);
        hotspotSize = 40;
        hotspotMove = setInterval(moveHotspots, 5000);
      } else if (phase === 3) {
        timeLeft = Math.max(timeLeft, 15);
        hotspotSize = 30;
        hotspotMove = setInterval(moveHotspots, 3000);
      } else if (phase === 4) {
        timeLeft = Math.max(timeLeft, 10);
        hotspotSize = 20;
        hotspotMove = setInterval(moveHotspots, 1000);
      }
      resizeHotspots();
      document.getElementById("timer").innerText = "剩余时间/Time Left：" + timeLeft + " 秒/sec";
      startTimer();
    }

    function resizeHotspots() {
      document.querySelectorAll(".hotspot").forEach(hs => {
        hs.style.width = hotspotSize + "px";
        hs.style.height = hotspotSize + "px";
      });
    }

    function react(correct, part, points) {
      const randomFace = faces[Math.floor(Math.random() * faces.length)];
      document.getElementById("dog").src = randomFace;

      if (correct) {
        score += points;
        timeLeft += 2;
      } else {
        score += points;
        timeLeft -= 5; // 错误惩罚更狠
      }
      if (score < 0) score = 0;
      document.getElementById("score").innerText = "分数/Score：" + score;

      document.getElementById("reaction").innerHTML =
        (correct ? "✅ 正确 / Correct" : "❌ 错误 / Wrong") +
        " - 你点了 " + part +
        " (积分/Points " + (points > 0 ? "+" : "") + points + ")";

      if (score >= 100 && phase === 1) {
        openMenu("🎉 100分！选择一个视频<br>🎉 100 Points! Choose a video:", [
          {name:"开心 / Happy", file:"happy.mp4"},
          {name:"搞笑 / Funny", file:"funny.mp4"},
          {name:"神秘 / Mystery", file:"mystery.mp4"}
        ]);
        setPhase(2);
      } else if (score >= 200 && phase === 2) {
        openMenu("🎉 200分！神秘视频<br>🎉 200 Points! Mystery video:", [
          {name:"神秘 / Secret", file:"secret.mp4"}
        ]);
        setPhase(3);
      } else if (score >= 300 && phase === 3) {
        openMenu("🏆 300分！终极彩蛋<br>🏆 300 Points! Final Easter Egg:", [
          {name:"终极彩蛋 / Ultimate Egg", file:"ultimate.mp4"}
        ]);
        setPhase(4);
      }
    }

    function moveHotspots() {
      document.querySelectorAll(".hotspot").forEach(hs => {
        hs.style.left = Math.random() * 200 + "px";
        hs.style.top = Math.random() * 150 + "px";
      });
    }

    function openMenu(title, options) {
      clearInterval(countdown);
      bgm.pause();
      document.getElementById("videoMenu").style.display = "block";
      document.querySelector("#videoMenu h2").innerHTML = title;
      const optionsDiv = document.getElementById("videoOptions");
      optionsDiv.innerHTML = "";
      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.innerText = opt.name;
        btn.onclick = () => playVideo(opt.file);
        optionsDiv.appendChild(btn);
      });
    }

    function playVideo(file) {
      const player = document.getElementById("videoPlayer");
      player.src = file;
      player.style.display = "block";
      player.play();
      document.getElementById("videoOptions").innerHTML = "🎬 正在播放... / Now Playing...";
      player.onended = () => closeMenu();
    }

    function closeMenu() {
      document.getElementById("videoMenu").style.display = "none";
      const player = document.getElementById("videoPlayer");
      player.pause();
      player.style.display = "none";
      bgm.play();
      startTimer();
    }

    function toggleMusic() {
      if (bgm.paused) {
        bgm.play();
        musicBtn.innerText = "暂停音乐 / Pause Music";
      } else {
        bgm.pause();
        musicBtn.innerText = "播放音乐 / Play Music";
      }
    }

    // ✅ Leaderboard 部分
    function saveScore(name, score) {
      let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
      leaderboard.push({name, score});
      leaderboard.sort((a,b) => b.score - a.score);
      leaderboard = leaderboard.slice(0, 10);
      localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
      displayLeaderboard();
    }

    function displayLeaderboard() {
      let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
      const list = document.getElementById("leaderboardList");
      list.innerHTML = "";
      leaderboard.forEach(entry => {
        const li = document.createElement("li");
        li.textContent = `${entry.name} - ${entry.score} 分`;
        list.appendChild(li);
      });
    }

    function gameOver() {
      clearInterval(countdown);
      let playerName = prompt("请输入名字 / Enter your name:");
      if (playerName) {
        saveScore(playerName, score);
      }
      alert("时间到！游戏结束！\nTime’s up! Game Over!");
    }

    // 初始化排行榜
    displayLeaderboard();
    setPhase(1);
  </script>
</body>
</html>
